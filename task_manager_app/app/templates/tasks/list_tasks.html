{% extends "base.html" %}

{% block content %}
    <h2>{{ title }}</h2>
    <div class="mb-3">
        <a href="{{ url_for('create_task') }}" class="btn btn-success">Create New Task</a>
    </div>

    <form method="GET" action="{{ url_for('list_tasks') }}" class="form-inline mb-3">
        <div class="form-group mr-2">
            <input type="text" name="q" class="form-control" placeholder="Search tasks..." value="{{ search_query or '' }}">
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
        {% if search_query %}
            <a href="{{ url_for('list_tasks') }}" class="btn btn-secondary ml-2">Clear Search</a>
        {% endif %}
    </form>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Due Date</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Category</th>
                <th>Assigned To</th>
                <th>Created By</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else 'N/A' }}</td>
                <td>{{ task.priority }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.category.name if task.category else 'N/A' }}</td>
                <td>{{ task.assignee.username if task.assignee else 'N/A' }}</td>
                <td>{{ task.creator.username if task.creator else 'N/A' }}</td>
                <td>
                    <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
                    <form action="{{ url_for('delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                        <input type="submit" value="Delete" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this task?');">
                    </form>
                    <!-- Example for a status update - can be a dropdown or separate buttons -->
                    <form action="{{ url_for('update_task_status', task_id=task.id) }}" method="POST" style="display:inline;">
                        <select name="status" onchange="this.form.submit()">
                            <option value="To Do" {% if task.status == 'To Do' %}selected{% endif %}>To Do</option>
                            <option value="In Progress" {% if task.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                            <option value="Completed" {% if task.status == 'Completed' %}selected{% endif %}>Completed</option>
                        </select>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
